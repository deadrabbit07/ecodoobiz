# 📚 OCR 핵심 기술 용어 및 코드 상세 분석 가이드

본 문서는 하이브리드 OCR 최종 코드(`easyocr_solution.py`)에 사용된 주요 모듈, 기술 용어, 그리고 코드의 핵심 로직을 상세히 설명하여 사용자의 기술적 이해를 돕기 위해 작성되었습니다.

---

## 1. 사용된 모듈 및 역할 분석

| 모듈 이름 | 역할 (What it does) | OCR 솔루션 내에서의 구체적 역할 | Tesseract 제거 이유 |
|------------|----------------------|----------------------------------|----------------------|
| **OpenCV (cv2)** | 컴퓨터 비전 라이브러리. 이미지 처리, 객체 탐지, 영상 분석 기능 제공. | 이미지 불러오기, 색상 변환(HSV), 금색 영역 마스크 생성, 윤곽선 탐지를 통한 금속판 영역(ROI) 추출. | N/A (탐지 레이어로 사용) |
| **EasyOCR** | 딥러닝 기반의 OCR 엔진. 복잡한 환경에서 높은 정확도의 문자열 인식. | 크롭된 금속판 영역(Sub-ROI)을 입력받아 실제 텍스트를 추출. 인식 정확도가 Tesseract보다 월등히 높음. | N/A (인식 레이어로 사용) |
| **Tesseract** | 전통적인 이미지 처리 기반의 OCR 엔진. (초기 시도에 사용됨) | (제거됨) 낮은 인식률이 문제였습니다. 특히 금속판의 빛 반사나 그림자 때문에 문자의 형태를 왜곡하여 오인식률이 높았습니다. | EasyOCR에 비해 정확도가 낮아 최종 단계에서 EasyOCR로 대체됨. |
| **Numpy (np)** | Python의 과학 계산 라이브러리. 주로 대규모 배열 및 행렬 연산에 사용됨. | OpenCV가 이미지를 행렬(Numpy Array) 형태로 처리하기 때문에, 이미지 데이터를 다루는 데 기본적으로 사용됨. | N/A (Python 내부 이미지 처리 기본 의존성) |
| **re** | 정규 표현식(Regular Expression) 모듈. 문자열 패턴 매칭 및 검색 기능 제공. | 추출된 텍스트가 `^[A-Z0-9]{5}$` 패턴(5글자 영문/숫자)을 만족하는지 검사하여, 노이즈 및 잘못 인식된 문자열을 필터링하는 데 사용됨. | N/A (문자열 후처리 필터) |

---

## 2. 핵심 기술 용어 해설

| 용어 | 정의 (Definition) | 코드 내 역할 |
|------|------------------|--------------|
| **HSV 색상 공간** | Hue(색상), Saturation(채도), Value(명도)로 색상을 표현하는 방식. 사람의 눈과 비슷하게 특정 색상을 추출하기 쉬움. | BGR(RGB) 이미지에서 금속판의 '금색'만을 분리하기 위해 사용됨. (색상 기반 탐지) |
| **Mask (마스크)** | 특정 영역을 분리하거나 가리기 위한 흑백 이미지 필터. | HSV 기반으로 '금색'에 해당하는 픽셀만 흰색으로 표시하고, 나머지는 검은색으로 표시하는 필터 역할을 수행. |
| **Contour (윤곽선)** | 이미지 내에서 동일한 색상이나 밝기 값을 가진 연속적인 곡선 (객체의 경계선). | 마스크 이미지에서 흰색 영역(금색 판)의 외곽선을 찾아내어, 이 외곽선을 감싸는 사각형 좌표(boundingRect)를 얻는 데 사용됨. |
| **ROI (Region of Interest)** | 관심 영역. 이미지 전체가 아닌, 분석이 필요한 특정 영역. | 윤곽선 탐지를 통해 찾아낸 개별 금속판의 전체 사각형 영역을 의미. |
| **크롭된 Sub-ROI** | ROI 중에서도 특정 문자열이 위치할 것이라고 예측되는 작은 하위 영역. | 금속판 전체가 아닌, 문자가 새겨진 중앙 하단 40% 영역만 잘라내는 것. EasyOCR이 불필요한 배경을 분석하지 않도록 효율성을 높임. |

---

## 3. 코드 로직 상세 분석

최종 코드에서 가장 중요한 두 가지 최적화 로직을 설명합니다.

### 3.1 금색 범위 정의 (lower_gold, upper_gold)

이 코드는 금색 판의 빛 반사에도 불구하고 안정적으로 금속을 탐지하기 위해 광범위한 HSV 범위를 사용합니다.

```python
lower_gold = (10, 50, 50)   # H: 10, S: 50, V: 50
upper_gold = (35, 255, 255) # H: 35, S: 255, V: 255
mask = cv2.inRange(hsv, lower_gold, upper_gold)
```

| 파라미터 | 값 범위 | 의미 |
|-----------|----------|------|
| **Hue (H)** | 10 ~ 35 | 노란색부터 주황색 계열까지의 색상(금색의 본질적인 색). |
| **Saturation (S)** | 50 ~ 255 | 채도. 너무 낮은 채도(회색)는 제외하고, 충분히 색이 있는 영역만 포함. |
| **Value (V)** | 50 ~ 255 | 밝기/명도. 너무 어두운 영역(완전한 그림자)은 제외하고, 어느 정도 밝기가 있는 금속 면적을 포함. |

---

### 3.2 문자열 영역 크롭 (Sub-ROI 계산)

이 계산은 문자가 항상 금속판 하단 중앙에 위치한다는 이미지의 규칙성을 EasyOCR에 활용하기 위한 핵심 단계입니다.

```python
# y: 금속판 상단 좌표, h: 금속판 전체 높이, w: 금속판 전체 너비
crop_y_start = int(y + h * 0.6)  # 높이의 60% 지점부터 시작
crop_h = int(h * 0.4)            # 전체 높이의 40%만 사용 (하단 영역)
crop_x_start = int(x + w * 0.15) # 너비의 15% 지점부터 시작
crop_w = int(w * 0.7)            # 전체 너비의 70%만 사용 (좌우 여백 제거)
```

이 계산 덕분에 EasyOCR은 금속판 전체(금속의 굴곡, 주변 그림자 등 노이즈 포함)가 아닌, 문자열이 가장 깨끗하게 새겨진 영역에만 분석 자원을 집중할 수 있게 되어 정확도가 극대화됩니다.
